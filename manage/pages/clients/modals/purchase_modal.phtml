<!-- New Purchase Modal -->
<div class="modal fade" id="newPurchaseModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">New Purchase</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      
      <form id="addPurchaseForm">
        <div class="modal-body">
          <input type="hidden" name="client_id" id="purchaseClientId">
          
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Project</label>
              <select name="project_id" id="purchaseProject" class="form-select" required onchange="loadAvailablePlots()">
                <option value="">Select Project</option>
                <?php
                $projects = $db->orderBy('id', 'ASC')->get(T_PROJECTS);
                foreach ($projects as $project) {
                  echo '<option value="' . $project->slug . '">' . htmlspecialchars($project->name) . '</option>';
                }
                ?>
              </select>
            </div>

            <div class="col-md-6">
              <label class="form-label">Available Plots</label>
              <select name="purchase_id" id="purchasePlot" class="form-select" required>
                <option value="">Select Plot</option>
              </select>
            </div>

            <div class="col-md-6">
              <label class="form-label">File Number</label>
              <input type="text" name="file_num" id="purchaseFileNum" class="form-control" required>
            </div>

            <div class="col-md-6">
              <label class="form-label">Per Katha (৳)</label>
              <input type="number" name="per_katha" id="purchasePerKatha" class="form-control" min="0" step="0.01" required>
            </div>

            <div class="col-md-6">
              <label class="form-label">Booking Money (৳)</label>
              <input type="number" name="booking_money" id="purchaseBookingMoney" class="form-control" min="0" step="0.01">
            </div>

            <div class="col-md-6">
              <label class="form-label">Down Payment (৳)</label>
              <input type="number" name="down_payment" id="purchaseDownPayment" class="form-control" min="0" step="0.01">
            </div>

            <div class="col-md-6">
              <label class="form-label">Purchase Date</label>
              <input type="date" name="purchase_date" id="purchaseDate" class="form-control" value="<?php echo date('Y-m-d'); ?>" required>
            </div>

            <div class="col-md-6">
              <label class="form-label">Nominees</label>
              <select name="nominee_ids[]" id="purchaseNominees" class="form-select" multiple>
                <?php foreach ($nominees as $nominee): ?>
                  <option value="<?php echo $nominee->id; ?>">
                    <?php echo htmlspecialchars($nominee->name); ?>
                    <?php if (!empty($nominee->relation)): ?>
                      (<?php echo htmlspecialchars($nominee->relation); ?>)
                    <?php endif; ?>
                  </option>
                <?php endforeach; ?>
              </select>
            </div>
          </div>

          <div id="purchaseAlert" class="mt-3"></div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Register Purchase</button>
        </div>
      </form>
    </div>
  </div>
</div>
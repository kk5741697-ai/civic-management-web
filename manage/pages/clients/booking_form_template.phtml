<!-- Booking Form Template Component -->
<?php
$bg_url = '';
if ($booking['project'] === 'moon-hill') $bg_url = "/manage/pages/clients/moon-hill.jpg?version=4.4.51";
elseif ($booking['project'] === 'hill-town') $bg_url = "/manage/pages/clients/hill-town.jpg?version=4.4.51";
?>

<section class="print_area d-none"
         id="print_area_<?= (int)$p['id'] ?>"
         data-purchase-id="<?= (int)$p['id'] ?>"
         style="background: url('<?= $bg_url ?>') no-repeat center center; background-size: cover;">
  <div class="invoice-layout">
    <div class="changable-content" id="changable_modal_content_<?= $index ?>">
      <?php
        global $project_mapping, $db;
        $field_positions = $db->where('project_id', $project_mapping[$booking['project']])->get('field_positions');
        foreach ($field_positions as $fp):
          $style = json_decode($fp->style_json, true);
          $name = $fp->field_name;
          $top = $style['top'] ?? '0px';
          $left = $style['left'] ?? '0px';
          $width = $style['width'] ?? 'auto';
          $fontSize = $style['fontSize'] ?? '15px';
          $letterSpacing = $style['letterSpacing'] ?? '0px';
          $textAlign = $style['textAlign'] ?? 'left';
          $value = '';

          switch ($name) {
            case 'client_id': $value = $client['id']; break;
            case 'project_name': $value = $proj_html; break;
            case 'applicant_name': $value = $client['name']; break;
            case 'block': $value = $booking['block']; break;
            case 'plot': $value = $booking['plot']; break;
            case 'katha': $value = $booking['katha']; break;
            case 'facing': $value = $booking['facing']; break;
            case 'road': $value = $booking['road']; break;
            case 'date': $value = date('d m Y', $p['time']); break;
            case 'reference':
              if (!empty($wo['additional']['reference'])) {
                $refUser = Wo_UserData($wo['additional']['reference']);
                $value = $refUser['name'] ?? '';
              }
              break;
            default:
              global $wo;
              if (!empty($wo['additional'][$name])) $value = htmlspecialchars($wo['additional'][$name]);
          }
      ?>
        <span class="<?= htmlspecialchars($name, ENT_QUOTES) ?>"
              style="position:absolute;top:<?= htmlspecialchars($top, ENT_QUOTES) ?>;left:<?= htmlspecialchars($left, ENT_QUOTES) ?>;width:<?= htmlspecialchars($width, ENT_QUOTES) ?>;font-size:<?= htmlspecialchars($fontSize, ENT_QUOTES) ?>;text-align:<?= htmlspecialchars($textAlign, ENT_QUOTES) ?>;letter-spacing:<?= htmlspecialchars($letterSpacing, ENT_QUOTES) ?>;white-space:normal;line-height:1.4;">
          <?= htmlspecialchars($value) ?>
        </span>
      <?php endforeach; ?>
    </div>
  </div>
</section>

<style>
.invoice-layout {
  position: relative;
  width: 100%;
  height: 100vh;
  page-break-inside: avoid;
}

.print_area {
  position: relative;
  width: 210mm;
  height: 297mm;
  margin: 0 auto;
  background-color: white;
}

@media print {
  .print_area {
    width: 100% !important;
    height: 100% !important;
    margin: 0 !important;
    box-shadow: none !important;
    page-break-inside: avoid;
  }
  
  .invoice-layout {
    height: 100vh !important;
  }
}

/* Enhanced form field positioning */
.changable-content span {
  font-family: Arial, sans-serif;
  color: #000;
  font-weight: 600;
}

.changable-content .client_id {
  color: #2c3e50;
}

.changable-content .project_name {
  color: #e74c3c;
  text-transform: uppercase;
  font-weight: 700;
}

.changable-content .applicant_name {
  color: #2980b9;
  font-weight: 700;
}

.changable-content .date {
  color: #8e44ad;
  font-family: monospace;
}
</style>